<script type="text/javascript">
var jdCouponList = $('#jdCouponList');
var cid = <%= cid || 0%>;
function getJdCoupon(){
  $.ajax({
    url: 'https://api.uuhaodian.com/ddk/jd_coupons',
    type: 'GET',
    dataType: 'jsonp',
    data:{
      'cid': cid,
      'page': 0,
      'callback': 'callback_jdcoupon'
    },
    success:function(data){
    }
  });
}
var canvas_callback = function(data){
  if(data.status == 1){
    var cv = $("#cv" + data.id);
    cv.qrcode({
      render: "canvas",
      height: 104,
      width: 104,
      text: data.url
    });
  }
}
var callback_jdcoupon = function(data){
  if(data.status == 1){
    Util.createJdCoupon(data.result,jdCouponList,0,page);
    if(data.result.length >= pagesize){
      page ++;
      load = 1;
      loadingText.html('查看更多优惠券');
    }else{
      loadingText.html('没有更多了');
    }
  }
  else{
    loadingText.html('没有更多了');
  }

  $(".jd-coupon").hover(function(){
    var cv = $("#cv" + $(this).data("id"));
    if(cv.html() == ""){
      $.ajax({
        url: $(this).data("url"),
        type: 'GET',
        dataType: 'jsonp',
        data:{
          'callback': 'canvas_callback'
        },
        success:function(data){
        }
      });
    }
    $("#c" + $(this).data("id")).animate({right:'104px'});
  },
  function(){
    $("#c" + $(this).data("id")).animate({right: 0});
  });
};
//$(function(){

  $.cookie('ff_platform', 2, {path:"/"});
  getJdCoupon();

  /*$(document).on('scroll',function(){
    if(page%4 > 0){
      var _top = $(document).scrollTop(),
        scroll_height = Util.pageSize()['scrollHeight'],
        client_height = Util.pageSize()['clientHeight'];
        if(_top + client_height >= (scroll_height-800)){
          getJdCoupon();
        }
    }
  });

  loadingText.on('click',function(){
    getJdCoupon();
  });*/

//});
</script>
